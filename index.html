<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸ’– Love Notes</title>

  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json" />

  <!-- Icons -->
  <link rel="icon" href="icon.png" />
  <link rel="apple-touch-icon" href="icon.png" />

  <!-- Theme & iOS PWA Support -->
  <meta name="theme-color" content="#ffb6c1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />

  <link rel="stylesheet" href="style.css" />

  <style>
    body {
      font-family: 'Comic Sans MS', cursive, sans-serif;
      background-color: #fff0f5;
      color: #d63384;
      text-align: center;
      padding: 2rem;
    }

    h1 { font-size: 2.5rem; }
    .note { font-size: 1.5rem; margin-top: 2rem; background: #ffe6f0; padding: 1rem; border-radius: 10px; display: inline-block; min-height: 100px; }
    .heart { font-size: 3rem; animation: pulse 2s infinite; margin-top: 1rem; cursor: pointer; }

    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }

    #notes { margin-top: 2rem; max-width: 400px; margin-left:auto; margin-right:auto; text-align:left; }
    #noteInput { width: 70%; padding: 0.5rem; margin-top: 1rem; border-radius: 5px; border: 1px solid #ccc; }
    #sendNote { padding: 0.5rem 1rem; margin-left:0.5rem; border:none; border-radius:5px; background:#ff69b4; color:white; cursor:pointer; }
    #install-btn { display:none; margin:2rem auto; padding:1rem 2rem; background:#ff69b4; color:white; font-size:1rem; border:none; border-radius:10px; cursor:pointer; box-shadow:0 4px 10px rgba(0,0,0,0.1); }
  </style>
</head>
<body>

  <!-- Music Toggle -->
  <button id="music-toggle">ğŸµ Play Music</button>
  <audio id="background-music" loop src="MyPatrycja.wav"></audio>

  <!-- Greeting -->
  <h1>ğŸ’– CzeÅ›Ä‡ kochanie!</h1>

  <!-- Love Note Message -->
  <div class="note"></div>

  <!-- Animated Heart -->
  <div class="heart">â¤ï¸</div>
  <p>Tap The Heart</p>

  <!-- Shared Notes -->
  <h2>ğŸ“” Shared Notes</h2>
  <ul id="notes"></ul>
  <input id="noteInput" placeholder="Write a love note..." />
  <button id="sendNote">ğŸ’Œ Send</button>

  <!-- Install button (for Android PWA) -->
  <button id="install-btn">ğŸ“² Install Love Notes</button>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBWtN8SaDA6DV36zTATKP7pT4y5OllS9HQ",
      authDomain: "true-loves-connection.firebaseapp.com",
      projectId: "true-loves-connection",
      storageBucket: "true-loves-connection.appspot.com",
      messagingSenderId: "107010363938",
      appId: "1:107010363938:web:3d44c5b25f3633d4aef07b",
      measurementId: "G-0FT36T6PQP"
    };

    // Init Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getFirestore(app);

    // DOM Elements
    const noteDiv = document.querySelector(".note");
    const heart = document.querySelector(".heart");
    const musicToggle = document.getElementById('music-toggle');
    const music = document.getElementById('background-music');
    const notesList = document.getElementById("notes");
    const noteInput = document.getElementById("noteInput");
    const sendNoteBtn = document.getElementById("sendNote");
    const installBtn = document.getElementById("install-btn");

    // Love Messages
    const loveMessages = [
      "I love you more every single day ğŸ’—",
      "You make my world brighter ğŸŒ",
      "You're my favourite person in the universe ğŸŒŒ",
      "Every moment with you is magic âœ¨",
      "Youâ€™re strong, beautiful, and deeply loved ğŸ’ªâ¤ï¸",
      "Your smile is my sunshine â˜€ï¸",
      "Just in case you forgot: I LOVE YOU! ğŸ’",
      "Youâ€™re not aloneâ€”I'm always with you ğŸ’«",
      "You are my home ğŸ¡",
      "You make my heart so full ğŸ’“",
      "Together is my favourite place to be ğŸ’•",
      "You light up my darkest days ğŸŒŸ",
      "With you, I am whole ğŸ’–",
      "You are my forever and always ğŸŒ¹",
      "Every love story is beautiful, but ours is my favourite ğŸ“–â¤ï¸",
      "I fall for you more every minute ğŸ’˜",
      "Your laugh is my favourite song ğŸ¶",
      "You are my dream come true ğŸ’«",
      "I cherish every moment spent with you â³",
      "You make my soul smile ğŸ˜„ğŸ’–",
      "In your arms, Iâ€™ve found my home ğŸ â¤ï¸"
    ];

    // Helper: get random message
    function getRandomMessage() {
      return loveMessages[Math.floor(Math.random() * loveMessages.length)];
    }

    // Show daily message
    noteDiv.innerHTML = `
      Here's your daily reminder:<br>
      <strong>${getRandomMessage()}</strong><br>
      Youâ€™re amazing and you matter to me every single day.
    `;

    // Heart tap interaction
    let loveCount = parseInt(localStorage.getItem('loveCount')) || 0;
    heart.addEventListener('click', (e) => {
      loveCount++;
      localStorage.setItem('loveCount', loveCount);
      noteDiv.innerHTML = `
        This is how much I love you:<br>
        <strong>${loveCount}</strong> ${loveCount===1?'time':'times'} â¤ï¸
      `;
    });

    // Music toggle
    if (music && musicToggle) {
      const savedMusicPlaying = localStorage.getItem('musicPlaying') === 'true';
      if (savedMusicPlaying) music.play();
      musicToggle.textContent = savedMusicPlaying?'ğŸ”‡ Pause Music':'ğŸµ Play Music';
      musicToggle.addEventListener('click', () => {
        if (music.paused) { music.play(); musicToggle.textContent='ğŸ”‡ Pause Music'; localStorage.setItem('musicPlaying','true'); }
        else { music.pause(); musicToggle.textContent='ğŸµ Play Music'; localStorage.setItem('musicPlaying','false'); }
      });
    }

    // Firebase Firestore: save note
    sendNoteBtn.addEventListener("click", async () => {
      const text = noteInput.value.trim();
      if (!text) return;
      await addDoc(collection(db,"notes"),{ text, timestamp: Date.now() });
      noteInput.value = "";
    });

    // Firebase Firestore: listen for updates
    const q = query(collection(db,"notes"), orderBy("timestamp"));
    onSnapshot(q, snapshot => {
      notesList.innerHTML = "";
      snapshot.forEach(doc => {
        const li = document.createElement("li");
        li.textContent = doc.data().text;
        notesList.appendChild(li);
      });
    });

    // PWA install prompt
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.style.display = 'block';
    });

    installBtn.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      const choiceResult = await deferredPrompt.userChoice;
      deferredPrompt = null;
      installBtn.style.display = 'none';
      console.log(choiceResult.outcome==='accepted'?'âœ… Installed':'âŒ Dismissed');
    });
  </script>

  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(() => console.log('âœ… Service Worker Registered'))
        .catch(err => console.error('âŒ Service Worker Failed:', err));
    }
  </script>
</body>
</html>
